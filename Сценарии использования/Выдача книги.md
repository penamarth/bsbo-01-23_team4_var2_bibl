# Сценарий выдачи книги

## Начало операции

1. Библиотекарь выбирает операцию "Выдать книгу" в системе.
2. Система запрашивает идентификатор книги.
3. Система запрашивает идентификатор читателя.

## Поиск книги

4. Библиотекарь вводит номер книги (сканирует штрих-код или вводит вручную).
5. Система ищет книгу по идентификатору.

## Поиск читателя

6. Библиотекарь вводит номер читательского билета.
7. Система ищет читателя по идентификатору.

## Проверка доступности книги

8. Если книга не найдена:
   - Система показывает сообщение: "Книга не найдена".
   - Сценарий завершается.

9. Если книга найдена, но не доступна для выдачи:
   - Система показывает сообщение: "Книга уже выдана".
   - Сценарий завершается.

## Проверка читателя

10. Если читатель не найден:
    - Система показывает сообщение: "Читатель не найден".
    - Сценарий завершается.

## Обновление статуса книги

11. Если все проверки пройдены:
    - Система помечает книгу как выданную (устанавливает isAvailable = false).

## Создание записи о выдаче

12. Система создает новую запись о выдаче (LOAN):
    - Устанавливает дату выдачи (loanDate = текущая дата).
    - Устанавливает срок возврата (dueDate = loanDate + период выдачи).
    - Связывает запись с книгой и читателем.

## Завершение операции

13. Система показывает сообщение: "Книга выдана читателю".
14. Операция завершена.

```plantuml
@startuml
title Диаграмма последовательности — Прецедент "Выдать книгу"

actor Librarian
participant "Library" as Lib
participant "IBookRepository" as BookRepo <<interface>>
participant "IReaderRepository" as ReaderRepo <<interface>>
participant "ILoanRepository" as LoanRepo <<interface>>
participant "Book"
participant "Reader"
participant "Loan"

Librarian -> Lib : IssueBook(bookId, readerId)

Lib -> BookRepo : GetBookById(bookId)
BookRepo --> Lib : book / null

alt "Книга не найдена"
    Lib --> Librarian : "Книга не найдена"
else
    alt "Книга уже выдана"
        Lib --> Librarian : "Книга уже выдана"
    else
        Lib -> ReaderRepo : GetReaderById(readerId)
        ReaderRepo --> Lib : reader / null

        alt "Читатель не найден"
            Lib --> Librarian : "Читатель не найден"
        else
            Lib -> Book : MarkAsBorrowed()
            Lib -> BookRepo : UpdateBook(book)

            Lib -> Loan : <<create>> Loan(bookId, readerId)
            Lib -> LoanRepo : AddLoan(loan)

            Lib --> Librarian : "Книга выдана читателю"
        end
    end
end
@enduml
```

![Выдача книги](Выдача%20книги.png)
